{% extends 'base.html' %}

{% block content %}
<div class="alert alert-info alert-dismissible fade show d-flex justify-content-between align-items-center flex-wrap gap-2 border border-dark" style="background-color:white;" role="alert">
    <p class="mb-0">
      Welcome to the task archive page! Here, you will be able to view all tasks that either manually or automatically archived. Tasks that are fully completed and past their deadline will be automatically archived and added to this page. You may also manually archive a task from the task page. 
    </p>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>  

<div class="container mt-4">
    <div class="card p-4 shadow">
        <h2 class="mb-4">Task Archive</h2>
        <table class="table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Due Date</th>
                    <th>Progress</th>
                    <th>Categories</th>
                    <th>Creator</th>
                </tr>
            </thead>
            <tbody>
                {% for task in archived_tasks %}
                <tr>
                    <td>{{ task.name }}</td>
                    <td>{{ task.description }}</td>
                    <td>{{ task.due_date|date:"M d, Y H:i" }}</td>
                    <td>{{ task.progress }}%</td>
                    <td>
                        {% for user in task.assigned_users.all %}
                            <span class="badge bg-secondary">{{ user.username }}</span>
                        {% empty %}
                            <span class="text-muted">None</span>
                        {% endfor %}
                    </td>
                    <td>
                        {% for category in task.categories.all %}
                            <span class="badge bg-secondary">{{ category.name }}</span>
                        {% empty %}
                            <span class="text-muted">None</span>
                        {% endfor %}
                    </td>
                    <td>
                        <button class="btn btn-danger btn-sm" onclick="confirmDelete({{ task.id }})">Delete</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    function confirmDelete(taskId) {
        if (confirm("Are you sure you want to permanently delete this task?")) {
            window.location.href = `/tasks/delete/${taskId}/`;
        }
    }
</script>

{% endblock %}
